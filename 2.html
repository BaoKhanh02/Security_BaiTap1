<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Affine Cipher Demo</title>
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Arial;padding:24px;background:#f4f6fb;color:#111}
  .card{background:white;padding:18px;border-radius:12px;max-width:900px;margin:auto;box-shadow:0 6px 20px rgba(0,0,0,0.06)}
  label{display:block;margin:8px 0 4px}
  textarea,input{width:100%;padding:8px;border-radius:8px;border:1px solid #ddd;box-sizing:border-box}
  button{padding:10px 14px;border-radius:8px;border:0;background:#2563eb;color:white;cursor:pointer;margin-right:8px}
  pre{background:#0f172a;color:#e6eef8;padding:10px;border-radius:8px;overflow:auto}
  .small{font-size:13px;color:#666}
</style>
</head>
<body>
<div class="card">
  <h2>Affine Cipher</h2>
  <div class="small">Công thức: C = (a * P + b) mod 26. P = a_inv * (C - b) mod 26.</div>

  <label for="text">Plaintext / Ciphertext</label>
  <textarea id="text" rows="4">Hello World</textarea>

  <div style="display:flex; gap:8px; margin-top:8px;">
    <div style="flex:1">
      <label>a (coprime with 26)</label>
      <input id="a" value="5" />
    </div>
    <div style="width:120px">
      <label>b (0..25)</label>
      <input id="b" value="8" />
    </div>
  </div>

  <div style="margin-top:10px;">
    <button id="enc">Encrypt</button>
    <button id="dec">Decrypt</button>
    <button id="brute">Brute-force (show candidates)</button>
  </div>

  <label style="margin-top:10px">Output</label>
  <pre id="output"></pre>
</div>

<script>
function egcd(a,b){
  if(b===0) return {g:a,x:1,y:0};
  let r = egcd(b, a % b);
  return {g: r.g, x: r.y, y: r.x - Math.floor(a / b) * r.y};
}
function modinv(a,m){
  let r = egcd(a,m);
  if(r.g !== 1) return null;
  return ((r.x % m) + m) % m;
}
function isAlpha(c){ return /[A-Za-z]/.test(c); }

function affineEncrypt(text,a,b){
  let out='';
  for(let ch of text){
    if(!isAlpha(ch)){ out += ch; continue; }
    let upper = ch === ch.toUpperCase();
    let base = upper ? 65 : 97;
    let p = ch.charCodeAt(0) - base;
    let c = (a * p + b) % 26;
    out += String.fromCharCode(c + base);
  }
  return out;
}
function affineDecrypt(text,a,b){
  let ainv = modinv(a,26);
  if(ainv===null) return 'ERROR: a has no inverse mod 26';
  let out='';
  for(let ch of text){
    if(!isAlpha(ch)){ out += ch; continue; }
    let upper = ch === ch.toUpperCase();
    let base = upper ? 65 : 97;
    let c = ch.charCodeAt(0) - base;
    let p = (ainv * ((c - b) % 26 + 26)) % 26;
    out += String.fromCharCode(p + base);
  }
  return out;
}

document.getElementById('enc').addEventListener('click', ()=>{
  let text = document.getElementById('text').value;
  let a = parseInt(document.getElementById('a').value);
  let b = parseInt(document.getElementById('b').value);
  document.getElementById('output').textContent = affineEncrypt(text,a,b);
});
document.getElementById('dec').addEventListener('click', ()=>{
  let text = document.getElementById('text').value;
  let a = parseInt(document.getElementById('a').value);
  let b = parseInt(document.getElementById('b').value);
  document.getElementById('output').textContent = affineDecrypt(text,a,b);
});
document.getElementById('brute').addEventListener('click', ()=>{
  let text = document.getElementById('text').value;
  let res='';
  const validAs = [1,3,5,7,9,11,15,17,19,21,23,25];
  for(let a of validAs){
    for(let b=0;b<26;b++){
      let dec = affineDecrypt(text,a,b);
      res += `a=${String(a).padStart(2,' ')} b=${String(b).padStart(2,' ')} -> ${dec}\n`;
    }
  }
  document.getElementById('output').textContent = res;
});
</script>
</body>
</html>
